# Railway Configuration for Wit API Server
# https://docs.railway.app/reference/config-as-code
#
# This deploys the API server (Git hosting, tRPC API, auth)
# For the web UI, deploy from apps/web directory separately

[build]
builder = "nixpacks"
buildCommand = "npm ci && npm run build"

[deploy]
startCommand = "npm run db:migrate && node dist/cli.js serve --port $PORT --repos /data/repos"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# ===========================================
# RAILWAY SETUP INSTRUCTIONS
# ===========================================
#
# 1. Create a new Railway project
# 2. Add PostgreSQL from the Railway dashboard
#    - DATABASE_URL is automatically set
#
# 3. Add a Volume for Git repos:
#    - Mount path: /data
#    - This persists your Git repositories
#
# 4. Set these environment variables:
#
# REQUIRED:
#   NODE_ENV=production
#   BETTER_AUTH_SECRET=<run: openssl rand -base64 32>
#   CORS_ORIGINS=https://your-web-app.up.railway.app
#   TRUSTED_ORIGINS=https://your-web-app.up.railway.app
#
# OPTIONAL (for AI features):
#   OPENAI_API_KEY=sk-...
#   ANTHROPIC_API_KEY=sk-ant-...
#
# 5. Deploy! Railway will:
#    - Build the TypeScript code
#    - Run database migrations
#    - Start the API server
