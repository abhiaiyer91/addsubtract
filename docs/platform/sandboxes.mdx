---
title: "Sandbox Providers"
description: "Isolated development environments for AI agents"
---

# Sandbox Providers

Wit supports multiple sandbox providers for running AI agents in isolated environments. Sandboxes provide secure, ephemeral compute environments where AI can safely execute code, run commands, and interact with repositories.

## Overview

Sandbox providers enable:

- **Secure code execution** - Isolated environments prevent AI from affecting your local system
- **Full development environments** - PTY support, file system access, and command execution
- **Resource limits** - Control CPU, memory, and disk usage
- **Network isolation** - Optional network restrictions for security

## Available Providers

| Provider | Startup Time | Use Case | Self-hosted |
|----------|-------------|----------|-------------|
| Docker | ~2-5s | Local development, self-hosted | Yes |
| E2B | ~150ms | Production, fast iteration | No |
| Vercel | ~1s | Node.js/Python workloads | No |
| Daytona | ~2s | Full dev environments | No |
| ComputeSDK | Varies | Multi-provider, GPU (Modal), collaboration | No |

## Docker Provider

Local container-based sandboxes using Docker. Best for self-hosted deployments.

### Features

- Full PTY support via `docker exec`
- Resource limits (CPU, memory, disk)
- Network isolation
- Volume mounting for repository access
- No external dependencies (self-hosted)

### Configuration

```typescript
import { DockerProvider } from 'wit/server/sandbox/providers/docker';

const docker = new DockerProvider({
  options: {
    image: 'wit-sandbox:latest',
    host: 'unix:///var/run/docker.sock', // Optional: custom Docker host
    security: {
      dropCapabilities: true,
      runAsNonRoot: true,
      readOnlyRootFs: false,
      noNetwork: false,
    },
  },
  defaults: {
    resources: {
      memoryMB: 512,
      cpuCores: 1,
      maxProcesses: 100,
    },
  },
});

await docker.initialize();
```

### Creating a Session

```typescript
const session = await docker.createSession({
  sessionId: 'session-123',
  userId: 'user-456',
  repository: 'myrepo',
  pty: { cols: 120, rows: 30 },
  env: {
    NODE_ENV: 'development',
  },
});

// Execute commands
const result = await session.exec('npm install');
console.log(result.stdout);

// Interactive PTY
session.on('data', (data) => console.log(data.toString()));
session.sendInput('ls -la\n');

// Cleanup
await session.stop();
```

### Building the Sandbox Image

```dockerfile
# Dockerfile for wit-sandbox
FROM node:20-slim

# Install common development tools
RUN apt-get update && apt-get install -y \
    git \
    curl \
    python3 \
    && rm -rf /var/lib/apt/lists/*

# Create non-root user
RUN useradd -m -u 1000 sandbox
USER sandbox
WORKDIR /workspace

CMD ["tail", "-f", "/dev/null"]
```

```bash
docker build -t wit-sandbox:latest .
```

---

## E2B Provider

Cloud-based Firecracker microVMs via [E2B](https://e2b.dev). Best for production with fast startup times.

### Features

- ~150ms sandbox startup
- Full filesystem access
- Command execution with streaming
- Code interpreter support (Python, JavaScript)
- Persistence via pause/resume (via dashboard)

### Configuration

```typescript
import { E2BProvider } from 'wit/server/sandbox/providers/e2b';

const e2b = new E2BProvider({
  options: {
    apiKey: process.env.E2B_API_KEY,
    templateId: 'base', // or custom template ID
  },
  defaults: {
    resources: {
      timeoutSeconds: 300,
    },
  },
});

await e2b.initialize();
```

### Environment Variables

```bash
E2B_API_KEY=your_api_key_here
```

### Creating a Session

```typescript
const session = await e2b.createSession({
  sessionId: 'session-123',
  userId: 'user-456',
  env: {
    GITHUB_TOKEN: process.env.GITHUB_TOKEN,
  },
});

// Execute commands
const result = await session.exec('pip install requests && python script.py');

// Run code directly (requires code interpreter template)
const codeResult = await session.runCode(`
import json
data = {"hello": "world"}
print(json.dumps(data))
`, 'python');

// Set timeout
await session.setTimeout(600000); // 10 minutes

// Cleanup
await session.stop();
```

---

## Vercel Sandbox Provider

Ephemeral compute via [Vercel Sandbox](https://vercel.com/docs/vercel-sandbox). Optimized for Node.js and Python.

### Features

- ~1s sandbox startup
- Full filesystem access
- Command execution with streaming
- File read/write operations
- Public URL for exposed ports
- Node.js 22 and Python 3.13 runtimes

### Configuration

```typescript
import { VercelProvider } from 'wit/server/sandbox/providers/vercel';

const vercel = new VercelProvider({
  options: {
    accessToken: process.env.VERCEL_TOKEN,
    teamId: process.env.VERCEL_TEAM_ID,
    projectId: process.env.VERCEL_PROJECT_ID,
    runtime: 'node22', // or 'python3.13'
    ports: [3000, 8080],
    vcpus: 2,
    timeoutMs: 300000, // 5 minutes (max: 45 minutes)
  },
});

await vercel.initialize();
```

### Environment Variables

```bash
VERCEL_TOKEN=your_access_token
VERCEL_TEAM_ID=your_team_id
VERCEL_PROJECT_ID=your_project_id
```

### Creating a Session

```typescript
const session = await vercel.createSession({
  sessionId: 'session-123',
  userId: 'user-456',
});

// Execute commands
const result = await session.exec('node --version');

// Run code
const codeResult = await session.runCode(`
console.log("Hello from Vercel Sandbox!");
`, 'javascript');

// Write and read files
await session.writeFiles([
  { path: '/app/index.js', content: 'console.log("test")' },
]);
const content = await session.readFile('/app/index.js');

// Get public URL for a port
const url = session.getDomain(3000);
console.log(`App available at: https://${url}`);

// Extend timeout
await session.setTimeout(600000); // Extend to 10 minutes

// Cleanup
await session.stop();
```

---

## Daytona Provider

Cloud development environments via [Daytona](https://www.daytona.io). Best for full-featured dev environments.

### Features

- Full PTY support with interactive terminals
- Git operations built-in
- Language Server Protocol support
- Snapshots for fast startup
- Auto-stop/auto-archive lifecycle management

### Configuration

```typescript
import { DaytonaProvider } from 'wit/server/sandbox/providers/daytona';

const daytona = new DaytonaProvider({
  options: {
    apiKey: process.env.DAYTONA_API_KEY,
    language: 'typescript', // default language
    snapshot: 'my-snapshot', // optional: use a pre-configured snapshot
    autoStopInterval: 15, // minutes
    labels: {
      environment: 'development',
    },
  },
  defaults: {
    resources: {
      cpuCores: 2,
      memoryMB: 4096,
      diskMB: 10240,
    },
  },
});

await daytona.initialize();
```

### Environment Variables

```bash
DAYTONA_API_KEY=your_api_key_here
```

### Creating a Session

```typescript
const session = await daytona.createSession({
  sessionId: 'session-123',
  userId: 'user-456',
  language: 'typescript',
  pty: { cols: 120, rows: 30 },
  env: {
    NODE_ENV: 'development',
  },
});

// Initialize PTY for interactive use
await session.initPty(120, 30);

// Interactive PTY events
session.on('data', (data) => process.stdout.write(data));
session.sendInput('npm run dev\n');

// Resize terminal
await session.resize(200, 50);

// Execute commands non-interactively
const result = await session.exec('npm test');

// Run code directly
const codeResult = await session.runCode(`
const x = 1 + 1;
console.log(x);
`);

// Archive for later (stops and saves state)
await session.archive();

// Resume from archive
await session.resume();

// Cleanup
await session.stop();
```

---

## ComputeSDK Provider

Unified multi-provider access via [ComputeSDK](https://computesdk.com). Enables access to Modal (GPU workloads), CodeSandbox (collaboration), and more through a single API.

### Features

- Unified API across multiple providers
- Zero-config auto-detection from environment variables
- Access to Modal for GPU-accelerated Python
- Access to CodeSandbox for collaborative sandboxes
- Seamless provider switching without code changes

### Configuration

```typescript
import { ComputeSDKProvider } from 'wit/server/sandbox/providers/computesdk';

const computesdk = new ComputeSDKProvider({
  type: 'computesdk',
  options: {
    // Explicit provider selection (or auto-detect from env)
    provider: 'modal', // 'e2b' | 'daytona' | 'modal' | 'codesandbox'
    // Provider-specific API key (or use env variables)
    providerApiKey: process.env.MODAL_TOKEN_ID,
    timeoutMs: 300000,
    autoDetect: true, // Auto-detect provider from environment
  },
});

await computesdk.initialize();
```

### Environment Variables

```bash
# Auto-detection checks these in order:
MODAL_TOKEN_ID=your_modal_token_id
MODAL_TOKEN_SECRET=your_modal_token_secret

# Or for other providers:
E2B_API_KEY=your_e2b_key
DAYTONA_API_KEY=your_daytona_key
CODESANDBOX_TOKEN=your_codesandbox_token

# ComputeSDK-specific config
SANDBOX_PROVIDER=computesdk
COMPUTESDK_PROVIDER=modal  # Override auto-detection
COMPUTESDK_TIMEOUT_MS=300000
```

### Creating a Session

```typescript
const session = await computesdk.createSession({
  sessionId: 'session-123',
  userId: 'user-456',
  env: {
    NODE_ENV: 'development',
  },
});

// Execute commands (works across all providers)
const result = await session.exec('python --version');
console.log(result.stdout);

// Run code directly
const codeResult = await session.runCode(`
import numpy as np
print(np.array([1, 2, 3]) * 2)
`, 'python');

// Cleanup
await session.stop();
```

### Use Cases

| Use Case | Recommended Provider via ComputeSDK |
|----------|-------------------------------------|
| GPU/ML workloads | Modal |
| Collaborative coding | CodeSandbox |
| Data science | E2B |
| Full dev environments | Daytona |

---

## Provider Comparison

### When to Use Each Provider

| Scenario | Recommended Provider |
|----------|---------------------|
| Local development | Docker |
| Self-hosted deployment | Docker |
| Fast iteration (CI/CD) | E2B |
| Production AI agents | E2B or Vercel |
| Full dev environment | Daytona |
| Node.js/Python workloads | Vercel |
| Cost-sensitive | Docker (self-hosted) |
| GPU/ML workloads | ComputeSDK (Modal) |
| Multi-provider flexibility | ComputeSDK |
| Collaborative sandboxes | ComputeSDK (CodeSandbox) |

### Feature Comparison

| Feature | Docker | E2B | Vercel | Daytona | ComputeSDK |
|---------|--------|-----|--------|---------|------------|
| PTY Support | Yes | Limited | No | Yes | Varies |
| File Operations | Yes | Yes | Yes | Yes | Yes |
| Code Interpreter | No | Yes | Yes | Yes | Yes |
| Network Isolation | Yes | Yes | Yes | Yes | Yes |
| Resource Limits | Yes | Yes | Limited | Yes | Varies |
| Persistence | Manual | Dashboard | No | Yes | Varies |
| Git Built-in | No | No | No | Yes | No |
| GPU Support | No | No | No | No | Yes (Modal) |
| Multi-provider | No | No | No | No | Yes |

---

## Health Checks

All providers implement health checks:

```typescript
const health = await provider.healthCheck();

console.log(health);
// {
//   healthy: true,
//   message: 'Provider is ready',
//   details: {
//     activeSessions: 3,
//     ...providerSpecificInfo
//   }
// }
```

---

## Session Management

### Listing Sessions

```typescript
// List all sessions
const sessions = await provider.listSessions();

// List sessions for a specific user
const userSessions = await provider.listSessions('user-456');
```

### Getting Session Stats

```typescript
const stats = await session.getStats();

console.log(stats);
// {
//   memoryBytes: 134217728,
//   cpuPercent: 15.5,
//   diskBytes: 52428800,
//   networkRxBytes: 1024000,
//   networkTxBytes: 512000,
//   uptimeSeconds: 300
// }
```

### Session Information

```typescript
const info = await session.getInfo();

console.log(info);
// {
//   id: 'session-123',
//   providerId: 'container-abc',
//   state: 'running',
//   createdAt: Date,
//   expiresAt: Date, // if applicable
//   metadata: { ... }
// }
```

---

## Error Handling

```typescript
try {
  const session = await provider.createSession(config);
} catch (error) {
  if (error.message.includes('Session limit')) {
    // User has too many active sessions
  } else if (error.message.includes('not initialized')) {
    // Provider needs initialization
    await provider.initialize();
  } else {
    // Other error
    console.error('Failed to create session:', error);
  }
}
```

---

## Best Practices

1. **Always clean up sessions** - Call `session.stop()` when done
2. **Set appropriate timeouts** - Prevent runaway sessions
3. **Use resource limits** - Prevent resource exhaustion
4. **Handle errors gracefully** - Sessions can fail unexpectedly
5. **Monitor session stats** - Track resource usage
6. **Use environment variables** - Never hardcode API keys
